:root {
    --bg-color: #121212;
    --panel-bg: #1e1e1e;
    --text-color: #e0e0e0;
    --accent-color: #4CAF50;
    --pending-color: #FFC107;
    --danger-color: #F44336;
    --border-color: #333;
    --map-bg: #000;
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: var(--bg-color);
    color: var(--text-color);
    height: 100vh;
    height: 100dvh; /* Dynamic Viewport Height for mobile */
    overflow: hidden;
}

#game-layout {
    display: grid;
    grid-template-columns: 400px 600px 300px 1fr; /* Expanded col 1 for runner list */
    height: 100%;
    width: 100%;
}

.game-column {
    background-color: var(--panel-bg);
    border-right: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
    height: 100%;
    overflow: hidden;
    padding: 0;
}

#col-main {
    padding: 1rem;
    overflow-y: auto;
}

#col-tracker, #col-log, #col-map {
    background-color: #181818;
}

#col-map {
    background-color: var(--map-bg);
    container-type: inline-size;
}

.column-header {
    padding: 0.8rem;
    background-color: #252525;
    border-bottom: 1px solid var(--border-color);
    text-align: center;
    flex-shrink: 0;
}

.column-header h2 {
    margin: 0;
    font-size: 1rem;
    color: #aaa;
    border: none;
}

h1 {
    text-align: center;
    margin-bottom: 1.5rem;
    color: var(--accent-color);
    font-size: 1.8rem;
    text-transform: uppercase;
    letter-spacing: 2px;
}

h2 {
    font-size: 1.1rem;
    margin-bottom: 0.8rem;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 0.4rem;
    color: #bbb;
}

.module {
    margin-bottom: 1.5rem;
    background: #252525;
    padding: 1rem;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.squad-stats {
    margin-bottom: 1rem;
}

#squad-level-display {
    color: var(--accent-color);
    font-size: 1.2rem;
    margin-bottom: 0.5rem;
}

#squad-counts {
    font-size: 0.9rem;
    color: #aaa;
}

.action-btn {
    width: 100%;
    padding: 0.8rem;
    background-color: var(--accent-color);
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 1rem;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.2s;
}

.action-btn:hover {
    background-color: #43a047;
}

.action-btn:disabled {
    background-color: #555;
    cursor: not-allowed;
    opacity: 0.7;
}

/* Runner Card Styles */
.runner-card {
    background: #000; /* Solid black per request */
    border: 1px solid #333;
    border-radius: 6px;
    padding: 0.8rem;
    margin-bottom: 0.8rem;
    position: relative;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.runner-card.state-upgrading {
    border-color: #FFC107;
}

.runner-card.state-queued {
    border-color: #9C27B0;
}

.runner-card.state-running {
    border-color: #2196F3;
    opacity: 0.8;
}

.runner-card.state-ready {
    border-color: #4CAF50;
}

.runner-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
}

.runner-name {
    font-weight: bold;
    color: #fff;
    font-size: 1rem;
}

.runner-state {
    font-size: 0.75rem;
    padding: 2px 6px;
    border-radius: 4px;
    font-weight: bold;
    text-transform: uppercase;
}

/* Scoped Badge Styles */
.runner-state.state-ready { background: #4CAF50; color: #fff; }
.runner-state.state-running { background: #2196F3; color: #fff; }
.runner-state.state-upgrading { background: #FFC107; color: #000; }
.runner-state.state-queued { background: #9C27B0; color: #fff; }

.runner-stats-4-col {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 2px;
    font-size: 0.75rem;
    color: #888;
    margin-bottom: 0.5rem;
    text-align: center;
}

.runner-stats-4-col > div {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.runner-stats-4-col span {
    font-weight: bold;
}

/* Text Colors */
.text-green { color: #4CAF50 !important; transition: color 0.2s; }
.text-red { color: #F44336 !important; transition: color 0.2s; }
.text-white { color: #fff !important; transition: color 0.2s; }

/* Relic Grid */
.relic-grid-container {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    grid-template-rows: auto auto;
    gap: 4px;
    margin-bottom: 0.5rem;
}

.relic-cell {
    background: #111;
    padding: 2px;
    text-align: center;
    border-radius: 2px;
    font-size: 0.75rem;
    font-family: monospace;
    color: #fff;
}

.upgrade-progress-container {
    background: #333;
    height: 8px;
    border-radius: 4px;
    overflow: hidden;
    margin-top: 8px;
    margin-bottom: 4px;
}

.upgrade-bar {
    height: 100%;
    background: #2196F3; /* Blue */
    width: 0%;
    transition: width 0.2s;
}

.upgrade-text {
    font-size: 0.75rem;
    color: #2196F3; /* Match bar color */
    text-align: center;
    font-weight: bold;
}

.send-btn {
    width: 100%;
    background: #4CAF50;
    color: #fff;
    border: none;
    padding: 6px;
    border-radius: 4px;
    font-weight: bold;
    cursor: pointer;
    margin-top: 8px;
}
.send-btn:hover { background: #43A047; }

/* Existing small-btn, warning, etc. */
.small-btn {
    padding: 0.4rem 0.8rem;
    background-color: #388E3C;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.8rem;
    transition: background 0.2s;
}
.warning {
    background-color: var(--danger-color);
    color: white;
    margin-top: 1rem;
    width: 100%;
}

/* Tracker & Log & Map Styles (mostly unchanged) */
#tracker-list {
    flex-grow: 1;
    overflow-y: auto;
    padding: 0.5rem;
}
.tracker-embed {
    background-color: #2f3136;
    border-left: 4px solid #3498db;
    border-radius: 4px;
    padding: 0.5rem;
    margin-bottom: 1rem;
}
.tracker-embed-header { font-weight: bold; color: #fff; margin-bottom: 0.5rem; }
.tracker-embed-description { color: #dcddde; margin-bottom: 1rem; }
.tracker-field { margin-bottom: 0.8rem; }
.tracker-field-name { font-weight: bold; color: #fff; font-size: 0.9rem; }
.tracker-field-value { font-size: 0.85rem; color: #dcddde; white-space: pre-wrap; }

#game-log-content {
    flex-grow: 1;
    overflow-y: auto;
    font-size: 0.85rem;
    font-family: monospace;
    padding: 0.5rem;
    color: #ccc;
}
.log-entry {
    margin-bottom: 6px;
    padding-bottom: 4px;
    border-bottom: 1px solid #2a2a2a;
    line-height: 1.3;
}

#map-scroll-area {
    flex-grow: 1;
    overflow-y: auto;
    overflow-x: hidden;
    padding-top: 1rem;
    display: flex;
    justify-content: center;
}
#map-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-bottom: 2rem;
    width: 100%; /* Stretch to full width */
    padding-left: 10px;
    padding-right: 10px;
}
.map-segment {
    margin-bottom: 0;
    text-align: center;
    user-select: none;
    display: flex;
    flex-direction: column;
    width: 100%; /* Fill container */
}
.map-row {
    display: flex;
    justify-content: space-between;
    width: 100%;
}
.map-cell {
    /* Responsive Desktop Styles */
    flex: 1;
    min-width: 0; /* Allow shrinking below content size to prevent row overflow */
    aspect-ratio: 1 / 1;
    display: flex;
    align-items: center;
    justify-content: center;
    /* Scale font based on container width (15 tiles ~ 6.66% each) */
    /* Reduced to 5.0cqw to ensure 15 emojis fit without overlap/overflow on all platforms */
    font-size: 5.0cqw;
    font-family: 'Segoe UI Emoji', sans-serif;
    line-height: 1;
}

#map-progress-container {
    padding: 0.5rem;
    background-color: #202020;
    border-top: 1px solid var(--border-color);
    font-size: 0.8rem;
    color: #bbb;
    font-family: monospace;
    height: 300px; /* Rigid height as requested */
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
}

#map-zones-list {
    flex: 1;
    overflow-y: auto;
    padding-right: 4px;
}

#map-summary-fixed {
    flex: 0 0 auto;
}
.map-progress-zone { margin-bottom: 0.5rem; border-bottom: 1px solid #333; padding-bottom: 0.2rem; }
.map-progress-header { color: var(--accent-color); font-weight: bold; margin-bottom: 2px; }
.map-progress-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 2px; }

::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-track { background: #1e1e1e; }
::-webkit-scrollbar-thumb { background: #444; border-radius: 4px; }
::-webkit-scrollbar-thumb:hover { background: #555; }

/* Mobile Navigation */
#mobile-tab-nav {
    display: none;
}

@media (max-width: 768px) {
    #game-layout {
        display: block;
        height: 100vh;
        height: 100dvh;
        overflow: hidden;
        position: relative;
    }

    /* Tabs Navigation */
    #mobile-tab-nav {
        display: flex;
        justify-content: space-around;
        background-color: #252525;
        border-bottom: 1px solid var(--border-color);
        padding: 0.5rem;
        height: 50px;
        align-items: center;
        width: 100%;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 100;
    }

    .tab-btn {
        background: none;
        border: none;
        color: #888;
        font-size: 1rem;
        font-weight: bold;
        cursor: pointer;
        padding: 0.5rem 1rem;
        border-bottom: 2px solid transparent;
        transition: all 0.2s;
    }

    .tab-btn.active {
        color: var(--accent-color);
        border-bottom-color: var(--accent-color);
    }

    /* Columns handling */
    .game-column {
        display: none; /* Hide all by default */
        position: absolute;
        top: 50px; /* Below nav */
        bottom: 0;
        left: 0;
        width: 100%;
        height: calc(100% - 50px);
        border-right: none;
    }

    /* Specific Tab Views */

    /* Tab 0: Squad */
    #game-layout.mobile-tab-0 #col-main {
        display: flex;
        z-index: 10;
        padding-bottom: calc(env(safe-area-inset-bottom) + 20px);
    }

    /* Tab 1: Tracker + Log Footer */
    #game-layout.mobile-tab-1 #col-tracker {
        display: flex;
        z-index: 10;
        padding-bottom: 200px; /* Space for log footer + safe area */
    }

    #game-layout.mobile-tab-1 #col-log {
        display: flex; /* Show log as well */
        z-index: 20;
        top: auto; /* Unset top */
        bottom: 0;
        height: 180px; /* Fixed footer height increased for safe area */
        padding-bottom: env(safe-area-inset-bottom);
        border-top: 1px solid var(--accent-color);
        background-color: #111;
        box-shadow: 0 -2px 10px rgba(0,0,0,0.5);
    }

    #game-layout.mobile-tab-1 #col-log .column-header {
         /* Hide big header for the footer log version to save space?
            Or keep it small. Let's make it very small or hide.
            User asked for "Log on bottom of screen".
            Let's keep header but make it compact. */
        padding: 0.2rem;
        min-height: auto;
    }
    #game-layout.mobile-tab-1 #col-log h2 {
        font-size: 0.8rem;
        margin: 0;
        border: none;
    }

    /* Tab 2: Map */
    #game-layout.mobile-tab-2 #col-map {
        display: flex;
        z-index: 10;
        padding-bottom: calc(env(safe-area-inset-bottom) + 20px);
    }

    /* Restore Fixed Map Layout for Mobile */
    #map-content {
        width: auto;
        padding-left: 0;
        padding-right: 0;
    }
    .map-segment {
        width: auto;
    }
    .map-row {
        justify-content: center;
        width: auto;
    }
    .map-cell {
        flex: 0 0 auto;
        width: 24px;
        height: 24px;
        font-size: 1.2rem;
    }
}

/* Upgrading Relic Border */
.relic-cell.upgrading-relic {
    border: 1px solid #4CAF50;
    box-shadow: 0 0 4px rgba(76, 175, 80, 0.5);
}
